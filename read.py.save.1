#!/usr/bin/python2.7
import sys
print(sys.version)

import MFRC522
import signal
import time
import os
from datetime import datetime

class Card:
        def __init__(self, uid, time):
                self.uid  = uid
                self.into = True
                self.time = time
        uid = [0, 0, 0, 0, 0]
        into = False
        time = 0



continue_reading = True
MIFAREReader = MFRC522.MFRC522()

cardA = Card([210,125,221,43,89], datetime.now())
#cardA = [210,125,221,43,89]

def end_read(signal, frame):
  global continue_reading
  continue_reading = False
  print "Ctrl+C captured, ending read."
  MIFAREReader.GPIO_CLEEN()

signal.signal(signal.SIGINT, end_read)

while continue_reading:
  (status,TagType) = MIFAREReader.MFRC522_Request(MIFAREReader.PICC_REQIDL)
  if status == MIFAREReader.MI_OK:
    print "Card detected"
  (status,backData) = MIFAREReader.MFRC522_Anticoll()
  if status == MIFAREReader.MI_OK:
    print "Card read UID: "+str(backData[0])+","+str(backData[1])+","+str(backData[2])+","+str(backData[3])+","+str(backData[4])
    if ( backData == cardA.uid ):
            
      f1 = open("../telegram/text1.txt", 'wb')
      f1.write("User with cardA is comming at" + cardA.time.strftime("%Y-%m-%d %H:%M:%S") )
      f1.close()
      f2 = open("../telegram/text2.txt", 'ab')
      f2.write("User with cardA is comming at" + cardA.time.strftime("%Y-%m-%d %H:%M:%S") + '/n')	
      f2.close()
      #time.sleep(5)
      os.system('python telegram.py')
    else:
      print "wrong Card"

